<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Quest IX - Guía de Alquimia</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323:wght@400&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚗️ Dragon Quest IX</h1>
            <h1>Guía Completa de Alquimia</h1>
            <p>Encuentra las recetas para crear tus equipos más poderosos</p>
        </div>
        <div class="search-section">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Busca por nombre de receta o ingrediente..." autocomplete="off">
                <select id="categoryFilter">
                    <option value="">Todas las categorías</option>
                    <option value="Espadas">Espadas</option>
                    <option value="Lanzas">Lanzas</option>
                    <option value="Cuchillos">Cuchillos</option>
                    <option value="Varas">Varas</option>
                    <option value="Látigos">Látigos</option>
                    <option value="Bastones">Bastones</option>
                    <option value="Garras">Garras</option>
                    <option value="Abanicos">Abanicos</option>
                    <option value="Hachas">Hachas</option>
                    <option value="Martillos">Martillos</option>
                    <option value="Bumeranes">Bumeranes</option>
                    <option value="Arcos">Arcos</option>
                    <option value="Escudos">Escudos</option>
                    <option value="Cabeza">Cabeza</option>
                    <option value="Torso">Torso</option>
                    <option value="Brazos">Brazos</option>
                    <option value="Piernas">Piernas</option>
                    <option value="Pies">Pies</option>
                    <option value="Accesorios">Accesorios</option>
                    <option value="Objetos">Objetos</option>
                </select>
                <button onclick="resetFilters()">Limpiar filtros</button>
            </div>
            <div class="filters-info">
                <p id="resultsCount">Cargando recetas...</p>
            </div>
        </div>
        <div class="recipes-section">
            <div class="recipes-grid" id="recipesContainer">
                <div class="no-results">Cargando recetas...</div>
            </div>
        </div>
    </div>
    <script>
        let recipes = [];

        // Load recipes from external JSON file
        async function loadRecipes() {
            try {
                const response = await fetch('recipes.json');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                recipes = await response.json();
                displayRecipes(recipes);
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('recipesContainer').innerHTML =
                    '<div class="no-results"><h2>Error</h2><p>No se pudieron cargar las recetas. Por favor, recarga la página.</p></div>';
            }
        }

        function displayRecipes(recipesToDisplay) {
            const container = document.getElementById('recipesContainer');
            const resultsCount = document.getElementById('resultsCount');

            if (recipesToDisplay.length === 0) {
                container.innerHTML = '<div class="no-results"><h2>Sin resultados</h2><p>No se encontraron recetas que coincidan con tu búsqueda.</p></div>';
                resultsCount.textContent = 'No se encontraron recetas';
                return;
            }

            container.innerHTML = recipesToDisplay.map(recipe => `
                    <div class="recipe-card">
                        <div class="recipe-title">${recipe.name}</div>
                        <span class="recipe-category">${recipe.category}</span>
                        <div class="recipe-ingredients">
                            <strong>Ingredientes:</strong>
                            ${recipe.ingredients.map(i => `<div class="ingredient-item"><span class="ingredient-name">${i.name}</span> x <span class="ingredient-quantity">${i.qty}</span></div>`).join('')}
                        </div>
                        <div class="stats"><strong>${recipe.ingredients.length}</strong> ingredientes necesarios</div>
                    </div>
                `).join('');

            resultsCount.textContent = `Mostrando ${recipesToDisplay.length} receta${recipesToDisplay.length !== 1 ? 's' : ''} de ${recipes.length} totales`;
        }

        function filterRecipes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;

            const filtered = recipes.filter(recipe => {
                const matchesSearch = !searchTerm ||
                    recipe.name.toLowerCase().includes(searchTerm) ||
                    recipe.ingredients.some(ing => ing.name.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilter || recipe.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });

            displayRecipes(filtered);
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            displayRecipes(recipes);
        }

        document.getElementById('searchInput').addEventListener('keyup', filterRecipes);
        document.getElementById('searchInput').addEventListener('input', filterRecipes);
        document.getElementById('categoryFilter').addEventListener('change', filterRecipes);

        // Initialize the page
        window.addEventListener('load', loadRecipes);
    </script>
</body>
</html>